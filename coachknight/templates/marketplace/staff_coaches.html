{% extends 'base.html' %}

{% block title %}Review Coaches - CoachKnight{% endblock %}

{% block content %}
<section class="section" style="padding-top: 6rem;">
    <div class="container">
        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; margin-bottom: 2rem;">
            <div>
                <h1>Review Coaches</h1>
                <p class="text-muted mb-0">Approve or reject coach applications</p>
            </div>
            <a href="{% url 'marketplace:staff_overview' %}" class="btn btn-secondary">‚Üê Back to Overview</a>
        </div>
        
        {% if messages %}
        {% for message in messages %}
        <div class="card mb-3" style="background: var(--success-bg); border-color: var(--success);">
            <p style="color: var(--success); margin: 0;">{{ message }}</p>
        </div>
        {% endfor %}
        {% endif %}
        
        <!-- Filters -->
        <div class="card mb-3">
            <form method="get" style="display: flex; gap: 1rem; flex-wrap: wrap; align-items: end;">
                <div class="form-group" style="margin-bottom: 0; flex: 1; min-width: 150px;">
                    <label>Status</label>
                    <select name="status" onchange="this.form.submit()">
                        <option value="">All</option>
                        <option value="new" {% if status_filter == 'new' %}selected{% endif %}>Pending</option>
                        <option value="approved" {% if status_filter == 'approved' %}selected{% endif %}>Approved</option>
                        <option value="rejected" {% if status_filter == 'rejected' %}selected{% endif %}>Rejected</option>
                    </select>
                </div>
                <div class="form-group" style="margin-bottom: 0; flex: 1; min-width: 150px;">
                    <label>Town</label>
                    <input type="text" name="town" value="{{ town_filter }}" placeholder="Filter by town">
                </div>
                <button type="submit" class="btn btn-secondary" style="height: fit-content;">Filter</button>
            </form>
        </div>
        
        <!-- Coaches List -->
        {% for coach in coaches %}
        <div class="card mb-3">
            <div style="display: flex; justify-content: space-between; align-items: start; flex-wrap: wrap; gap: 1rem;">
                <div style="flex: 1;">
                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem;">
                        <h3 style="margin: 0;">{{ coach.display_name }}</h3>
                        {% if coach.status == 'new' %}
                            <span class="badge" style="background: #fef3c7; color: #92400e;">Pending</span>
                        {% elif coach.status == 'approved' %}
                            <span class="badge badge-success">Approved</span>
                        {% else %}
                            <span class="badge">Rejected</span>
                        {% endif %}
                    </div>
                    <p class="text-muted" style="margin-bottom: 0.5rem;">{{ coach.email }} {% if coach.phone %}¬∑ {{ coach.phone }}{% endif %}</p>
                </div>
                
                {% if coach.status == 'new' %}
                <div style="display: flex; gap: 0.5rem;">
                    <form method="post" style="display: inline;">
                        {% csrf_token %}
                        <input type="hidden" name="coach_id" value="{{ coach.pk }}">
                        <input type="hidden" name="action" value="approve">
                        <button type="submit" class="btn btn-primary" style="padding: 0.5rem 1rem;">‚úì Approve</button>
                    </form>
                    <form method="post" style="display: inline;">
                        {% csrf_token %}
                        <input type="hidden" name="coach_id" value="{{ coach.pk }}">
                        <input type="hidden" name="action" value="reject">
                        <button type="submit" class="btn btn-secondary" style="padding: 0.5rem 1rem;">‚úó Reject</button>
                    </form>
                </div>
                {% endif %}
            </div>
            
            <hr style="margin: 1rem 0;">
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
                <div>
                    <p class="text-muted mb-0" style="font-size: 0.75rem;">TOWN</p>
                    <p style="margin: 0;"><strong>{{ coach.town }}</strong></p>
                </div>
                <div>
                    <p class="text-muted mb-0" style="font-size: 0.75rem;">TRAVEL</p>
                    <p style="margin: 0;"><strong>{{ coach.max_travel_miles }} mi{% if coach.has_car %} üöó{% endif %}</strong></p>
                </div>
                <div>
                    <p class="text-muted mb-0" style="font-size: 0.75rem;">TYPE</p>
                    <p style="margin: 0;"><strong>{{ coach.get_grade_level_display }}</strong></p>
                </div>
                <div>
                    <p class="text-muted mb-0" style="font-size: 0.75rem;">RATING</p>
                    <p style="margin: 0;"><strong>{{ coach.get_rating_range_display|default:"-" }}</strong></p>
                </div>
                <div>
                    <p class="text-muted mb-0" style="font-size: 0.75rem;">AVAILABILITY</p>
                    <p style="margin: 0;"><strong>{{ coach.availability|default:"-" }}</strong></p>
                </div>
                <div>
                    <p class="text-muted mb-0" style="font-size: 0.75rem;">SIGNED UP</p>
                    <p style="margin: 0;"><strong>{{ coach.created_at|date:"M d, Y" }}</strong></p>
                </div>
            </div>
            
            {% if coach.chesscom_username or coach.lichess_username %}
            <div style="margin-top: 1rem;">
                {% if coach.chesscom_username %}
                    <a href="https://chess.com/member/{{ coach.chesscom_username }}" target="_blank" class="badge badge-accent">Chess.com: {{ coach.chesscom_username }}</a>
                {% endif %}
                {% if coach.lichess_username %}
                    <a href="https://lichess.org/@/{{ coach.lichess_username }}" target="_blank" class="badge badge-accent">Lichess: {{ coach.lichess_username }}</a>
                {% endif %}
            </div>
            {% endif %}
            
            {% if coach.teaching_experience %}
            <div style="margin-top: 1rem;">
                <p class="text-muted mb-0" style="font-size: 0.75rem;">EXPERIENCE</p>
                <p style="margin: 0;">{{ coach.teaching_experience }}</p>
            </div>
            {% endif %}
        </div>
        {% empty %}
        <div class="card text-center" style="padding: 3rem;">
            <p class="text-muted">No coaches found matching your filters.</p>
        </div>
        {% endfor %}
        
    </div>
</section>
{% endblock %}
