{% extends 'mini_insta/base.html' %}

{% block content %}
<main class="grid profile-header">

<p><strong>{{ post.get_num_likes }} Likes</strong></p>

{% if request.user.is_authenticated %}
  {% if post.profile.user_id != request.user.id %}
    <form action="{% url 'mini_insta:like' post.pk %}" method="post" style="display:inline">
      {% csrf_token %}
      {% if liked_by_me %}
        <button formaction="{% url 'mini_insta:delete_like' post.pk %}" type="submit">Unlike</button>
      {% else %}
        <button type="submit">Like</button>
      {% endif %}
    </form>
  {% endif %}
{% endif %}
  <!-- Profile info -->
  <div class="profile-info">

  <!-- Like count -->
<p><strong>{{ post.get_num_likes }}</strong> {{ post.get_num_likes|pluralize:"Like,Likes" }}</p>

    <div class="profile-header-item">
      <p>{{ post.caption }}</p>
    </div>

    <div class="profile-header-item">
      <small>Posted: {{ post.timestamp }}</small>
    </div>
  </div>

  <div>
        <h2>Photos</h2>
        <!-- Display the photos about this post -->
        {% for photo in post.get_all_photos %}
            <div>
               <img src = "{{photo.get_image_url}}" />
               <p style="font-size:12px;color:#888">
  raw: {{ photo.image_file.name }} | url: {{ photo.get_image_url }}
</p> 
            </div>
        {% endfor %}
    </div>

<h3>Comments</h3>

{% with comments=post.get_all_comments %}
  {% if comments %}
    <ul>
      {% for c in comments %}
        <li>
          <strong>
            <a href="{% url 'mini_insta:show_profile' c.profile.pk %}">
              {{ c.profile.display_name }}
            </a>
          </strong>
          <small> Â· {{ c.timestamp }}</small>
          <div>{{ c.text }}</div>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>No comments yet.</p>
  {% endif %}
{% endwith %}

<p style="margin-top:1rem;">
  <a href="{% url 'mini_insta:update_post' post.pk %}" class="button">Update</a>
  <a href="{% url 'mini_insta:delete_post' post.pk %}" class="button" style="margin-left:.5rem;">Delete</a>
</p>
</main>
{% endblock %}
